<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>哒哒的博客</title>
    <meta name="description" content="哒哒练习写文章做记录的地方">
    <link rel="icon" href="/blog/img/logo.png">
    
    <link rel="preload" href="/blog/assets/css/0.styles.1846c831.css" as="style"><link rel="preload" href="/blog/assets/js/app.0d710046.js" as="script"><link rel="preload" href="/blog/assets/js/2.3724615d.js" as="script"><link rel="preload" href="/blog/assets/js/24.92a8097d.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.b61dd10e.js"><link rel="prefetch" href="/blog/assets/js/11.e5fbb993.js"><link rel="prefetch" href="/blog/assets/js/12.6072f3fe.js"><link rel="prefetch" href="/blog/assets/js/13.119ec9f1.js"><link rel="prefetch" href="/blog/assets/js/14.50793965.js"><link rel="prefetch" href="/blog/assets/js/15.6b54485c.js"><link rel="prefetch" href="/blog/assets/js/16.31f68c05.js"><link rel="prefetch" href="/blog/assets/js/17.4e4585ba.js"><link rel="prefetch" href="/blog/assets/js/18.68501181.js"><link rel="prefetch" href="/blog/assets/js/19.0e5b6c69.js"><link rel="prefetch" href="/blog/assets/js/20.d751fd77.js"><link rel="prefetch" href="/blog/assets/js/21.61020ecb.js"><link rel="prefetch" href="/blog/assets/js/22.6843e775.js"><link rel="prefetch" href="/blog/assets/js/23.c4fe93cf.js"><link rel="prefetch" href="/blog/assets/js/25.a3f181ca.js"><link rel="prefetch" href="/blog/assets/js/26.244f0e68.js"><link rel="prefetch" href="/blog/assets/js/27.87040a01.js"><link rel="prefetch" href="/blog/assets/js/28.1ce7f872.js"><link rel="prefetch" href="/blog/assets/js/29.a62422be.js"><link rel="prefetch" href="/blog/assets/js/3.e00b5bcc.js"><link rel="prefetch" href="/blog/assets/js/4.15bd42cb.js"><link rel="prefetch" href="/blog/assets/js/5.37f72eb9.js"><link rel="prefetch" href="/blog/assets/js/6.f95e396f.js"><link rel="prefetch" href="/blog/assets/js/7.3e10e91f.js"><link rel="prefetch" href="/blog/assets/js/8.853705b0.js"><link rel="prefetch" href="/blog/assets/js/9.39b50577.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.1846c831.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">哒哒的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/JS/object.html" class="nav-link">JS之面向对象程序设计和继承</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/base.html" class="nav-link">JS基础知识总结</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/copy.html" class="nav-link">JS深浅拷贝</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/design.html" class="nav-link">JS设计模式</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/this.html" class="nav-link">JS之this指向</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/ifelse.html" class="nav-link">JS条件语句</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/simple.html" class="nav-link">JS之代码简洁之道</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ReactNative</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/ReactNative/summary.html" class="nav-link">ReactNative技术栈总结</a></li><li class="dropdown-item"><!----> <a href="/blog/ReactNative/record.html" class="nav-link">ReactNative知识点记录</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Vue/base.html" class="nav-link">vue基础知识</a></li><li class="dropdown-item"><!----> <a href="/blog/Vue/vuex.html" class="nav-link">vuex基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">混合开发</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/hybird/cordova.html" class="nav-link">cordova基础</a></li><li class="dropdown-item"><!----> <a href="/blog/hybird/vueCordova.html" class="nav-link">vue+cordova思考</a></li><li class="dropdown-item"><!----> <a href="/blog/hybird/uniapp.html" class="nav-link">小程序多端框架研究</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Node/koa2.html" class="nav-link">koa2+sequelize初探</a></li><li class="dropdown-item"><!----> <a href="/blog/Node/fullStack.html" class="nav-link">全栈工程思考</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/http/base.html" class="nav-link">http协议总结</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">构建</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/goujian/webpack.html" class="nav-link">webpack学习</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/JS/object.html" class="nav-link">JS之面向对象程序设计和继承</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/base.html" class="nav-link">JS基础知识总结</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/copy.html" class="nav-link">JS深浅拷贝</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/design.html" class="nav-link">JS设计模式</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/this.html" class="nav-link">JS之this指向</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/ifelse.html" class="nav-link">JS条件语句</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/simple.html" class="nav-link">JS之代码简洁之道</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ReactNative</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/ReactNative/summary.html" class="nav-link">ReactNative技术栈总结</a></li><li class="dropdown-item"><!----> <a href="/blog/ReactNative/record.html" class="nav-link">ReactNative知识点记录</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Vue/base.html" class="nav-link">vue基础知识</a></li><li class="dropdown-item"><!----> <a href="/blog/Vue/vuex.html" class="nav-link">vuex基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">混合开发</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/hybird/cordova.html" class="nav-link">cordova基础</a></li><li class="dropdown-item"><!----> <a href="/blog/hybird/vueCordova.html" class="nav-link">vue+cordova思考</a></li><li class="dropdown-item"><!----> <a href="/blog/hybird/uniapp.html" class="nav-link">小程序多端框架研究</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Node/koa2.html" class="nav-link">koa2+sequelize初探</a></li><li class="dropdown-item"><!----> <a href="/blog/Node/fullStack.html" class="nav-link">全栈工程思考</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/http/base.html" class="nav-link">http协议总结</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">构建</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/goujian/webpack.html" class="nav-link">webpack学习</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>#HTTP 协议总结</p> <p>##Http 协议基础</p> <p>###经典五层模型</p> <blockquote><p>应用层——传输层——网络层——数据链路层——物理层</p></blockquote> <ol><li>物理层主要作用是定义物理设备如何传输数据，指代物理硬件</li> <li>数据链路层在通信的实体间建立数据链路连接，基本计算机二进制传输</li> <li>网络层为数据在节点之间传输创建逻辑链路</li> <li>传输层为 TCP 或 UDP，可以想象为一条管道</li> <li>应用层为 HTTP，可以想象为一个包</li></ol> <p>基本概念：一个 tcp 可以发送多个 http 请求，一个 http 请求必须在一个 tcp 连接里</p> <p>###http 发展历史
####http/0.9</p> <ul><li>只有一个命令 GET</li> <li>没有 HEADER 等描述数据的信息</li> <li>服务器发送完毕，就关闭 TCP 连接</li></ul> <p>####http/1.0</p> <ul><li>增加了很多命令，POST,PUT</li> <li>增加了 status code 和 header</li> <li>多字符集支持、多部分发送、权限、缓存等</li></ul> <p>####http/1.1</p> <ul><li>支持了持久连接</li> <li>pipeline,管道化</li> <li>增加 host 和其他一些命令</li></ul> <p>####http2</p> <ul><li>所有数据以二进制传输，摆脱原来的字符串</li> <li>同一个连接里面发送多个请求不再需要按照顺序来，并行</li> <li>头信息压缩以及推送等提高效率的功能，服务端可以主动发送信息，提升性能</li></ul> <p>###三次握手</p> <blockquote><p>http 不存在连接，只有请求和响应
TCP 连接可以发送多个 http 请求，TCP 连接有三次握手网络请求的消耗</p></blockquote> <ol><li>客户端发送连接数据包</li> <li>服务端开启 TCP SOCKET,再给客户端发送数据包</li> <li>客户端拿到数据包，再给服务端发送确认数据包</li></ol> <p>第三次是为了避免第二次握手丢失，导致服务端一直开启端口连接</p> <p>###URI——URL 和 URN
####URI</p> <blockquote><p>统一资源标志符/Uniform Resource Identifier</p></blockquote> <ul><li>用来唯一标识互联网上的信息资源</li> <li>包括 URL 和 URN</li></ul> <p>####URL</p> <blockquote><p>统一资源定位器/Uniform Resource Locator</p></blockquote> <ul><li>http://user:pass@host.com:80/path?query=string#hash</li> <li>http 协议</li> <li>user:pass 用户认证，基本用不到</li> <li>host.com 定位服务在互联网上的位子，可以为 IP 或者域名</li> <li>80 端口，web 服务，物理服务器上多个 web 服务，不带端口默认访问 80</li> <li>path 路由，web 服务上具体的内容</li> <li>query 搜索参数，如何进行搜索和查找，传参</li> <li>hash 锚点定位工具</li></ul> <p>此类格式的都叫做 URL，比如 http,ftp 协议</p> <p>####URN</p> <blockquote><p>永久统一资源定位符</p></blockquote> <ul><li>在资源移动之后还能被找到</li> <li>目前还没有非常成熟的使用方案</li></ul> <p>###http 报文格式</p> <p>####起始行</p> <ul><li>请求报文：GET /text/test.txt HTTP/1.0</li> <li>响应报文：HTTP/1.0 200 OK</li></ul> <p>####头部</p> <ul><li>请求头：Accept:text/* Accept-Language:en,fr</li> <li>响应头：Content-type:text/plain Content-length:19</li></ul> <p>####主体</p> <ul><li>请求体：参数</li> <li>响应体：返回的数据</li></ul> <p>####HTTP 的方法</p> <ul><li>用来定义对于资源的操作</li> <li>常用有 GET,POST 等</li> <li>从定义上讲有各自的语义</li></ul> <p>####HTTP CODE</p> <ul><li><p>定义服务器对请求的处理结果</p></li> <li><p>各个区间的 CODE 有各自的语义</p> <ul><li>100-199 还需要一些操作才能发送请求</li> <li>200-299 操作成功</li> <li>300-399 重定向</li> <li>400-499 发送的请求有问题 401 认证 403 被拒绝 404 找不到</li> <li>500-599 服务端问题</li></ul></li> <li><p>好的 HTTP 服务可以通过 CODE 判断结果</p></li></ul> <p>###创建一个简单的 web 服务</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
http
  <span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;req come&quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>##HTTP 各种特性</p> <p>###CORS 跨域请求的限制与解决</p> <blockquote><p>浏览器对于非同域的请求会拦截，请求还是会发送，后台服务返回内容，但是浏览器会拦截掉并报错</p></blockquote> <p>####简单请求</p> <ul><li>允许方法仅为 GET，HEAD，POST</li> <li>Content-Type 仅为 text/plain,multipart/form-data,application/x-www-form-urlencoded</li> <li>请求头限制，仅部分固定请求头允许</li> <li>XMLHttpRequestUpload 对象均没有注册任何事件监听器</li> <li>请求中没有使用 ReadableStream 对象</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>####预请求</p> <blockquote><p>先通过 OPTION 请求访问服务端，返回告诉浏览器允许接下来发送的 POST 请求，浏览器就不会拦截</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Access-Control-Allow-Headers&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">//允许的请求头</span>
  <span class="token string">&quot;Access-Control-Allow-Methods&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">//允许的请求方法</span>
  <span class="token string">&quot;Access-Control-Max-Age&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span> <span class="token comment">//预请求不需option验证的最大时间</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>####jsonp</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;http://127.0.0.1:8888&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><p>###Cache-Control</p> <ul><li><p>public 任何地方都可以进行缓存</p></li> <li><p>private 只有发起请求的浏览器进行缓存</p></li> <li><p>no-cache 本地可以存缓存，但需要后台验证过后才能使用</p></li> <li><p>max-age 秒数，缓存存在的最大时间</p></li> <li><p>s-maxage 秒数，在代理服务器，会代替 max-age</p></li> <li><p>max-stale 秒数，发起请求主动带的头的到期时间</p></li> <li><p>must-revalidate 重新验证</p></li> <li><p>proxy-revalidate 用在缓存服务器上，必须重新验证</p></li> <li><p>no-store 不存储缓存</p></li> <li><p>no-transform 用在代理服务器，不改动返回内容</p></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>http
  <span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;text/javascript&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;Cache-Control&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;max-age=20&quot;</span> <span class="token comment">//会取缓存的内容，请求不会发送到服务器</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>一般缓存会是一个比较长的时间，这就导致服务端更新内容，客户端却还是取老的静态资源。现在常用的方法是每次打包时在静态路径上添加一个 hash 码，hash 码根据文件改变而来，这样浏览器访问静态资源时就会从新请求。</p></blockquote> <p>###缓存验证 Last-Modified 和 Etag 的使用</p> <p>有 Cache-Control 的情况下
<img src="https://upload-images.jianshu.io/upload_images/9421914-35ed48b943da3263.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="http.png"></p> <p>####验证头
<strong>Last-Modified</strong>
上次修改时间，给资源设置上一次何时修改
配合 if-Modified-Since 或者 if-Unmodified-Since 使用
对比上次修改时间判断是否需要更新</p> <p><strong>Etag</strong>
数据签名，数据唯一标识，数据修改，那么签名会不一样
配合 if-Match 或者 If-Non-Match 使用
对比资源的签名判断是否使用缓存</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token comment">//服务端进行etag的验证</span>
<span class="token keyword">const</span> etag<span class="token operator">=</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'if-none-match'</span><span class="token punctuation">]</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>etag<span class="token operator">===</span><span class="token string">'777'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">304</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
        <span class="token string">'Cache-Control'</span><span class="token punctuation">:</span><span class="token string">'max-age=200000,no-cache'</span><span class="token punctuation">,</span>
        <span class="token string">'Last-Modified'</span><span class="token punctuation">:</span><span class="token string">'123'</span>
        <span class="token string">'Etag'</span><span class="token punctuation">:</span><span class="token string">'777'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
        <span class="token string">'Cache-Control'</span><span class="token punctuation">:</span><span class="token string">'max-age=200000,no-cache'</span><span class="token punctuation">,</span>
        <span class="token string">'Last-Modified'</span><span class="token punctuation">:</span><span class="token string">'123'</span>
        <span class="token string">'Etag'</span><span class="token punctuation">:</span><span class="token string">'777'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>###Cookie 和 Session</p> <p>####Cookie</p> <blockquote><p>在服务端返回数据时，通过 Set-Cookie 保存在浏览器，浏览器下次在同域的请求中会在头带上 Cookie，</p></blockquote> <ul><li>通过 Set-Cookie 设置</li> <li>下次请求会自动带上</li> <li>键值对，可以设置多个</li> <li>max-age 和 expires 设置过期时间</li> <li>Secure 只在 https 的时候发送</li> <li>HttpOnly 无法通过 document.cookie 访问</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> host <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>host
<span class="token keyword">const</span> html<span class="token operator">=</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'test.html'</span><span class="token punctuation">.</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>host <span class="token operator">===</span> <span class="token string">&quot;test.com&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;Set-Cookie&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;id=123;max-age=2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;abc=456;HttpOnly;domain=test.com&quot;</span><span class="token punctuation">]</span>
    <span class="token comment">//此时test.com下的所有二级域名都可以访问到cookie</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span>
</code></pre></div><p>####Session</p> <blockquote><p>经常做法是将保存在 session 中的用户唯一 ID 存入 Cookie,下次请求时拿到 Cookie，通过 Cookie 在 Session 拿到用户信息，进行操作。</p></blockquote> <p>###Http 长连接</p> <blockquote><p>http1.1 默认是长连接， 是在 tcp 上顺序发送请求，浏览器 tcp 并发限制为 6，就是同时可以存在 6 个连接。所以浏览器加载首页时，先创建 6 个 TCP 连接，然后 http 是在这六个连接中顺序发送的。</p></blockquote> <p>###数据协商</p> <blockquote><p>客户端在发送请求时，限定需要拿到的数据格式，内容等。服务端根据这些限制来操作，服务端不一定按照规定返回。
<strong>请求</strong></p></blockquote> <ul><li>Accept 想要的数据类型</li> <li>Accept-Encoding 数据编码方式进行传输，限制服务器对数据的压缩方式</li> <li>Accept-Language 希望展示的语言</li> <li>User-Agent 浏览器的相关信息
<strong>返回</strong></li> <li>Content-Type 实际返回的数据格式</li> <li>Content-Encoding 对应 Accept-Encoding，声明传输方式</li> <li>Content-Language 返回的语言</li></ul> <p>###重定向</p> <blockquote><p>通过 URL 访问资源时，服务器告诉浏览器资源换位子了，并告诉新的位置，浏览器再请求新的位置,301 永久变更，302 暂时变更，301 的返回会在缓存中提取</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">&quot;/old&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    Location<span class="token punctuation">:</span> <span class="token string">&quot;/new&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">&quot;/new&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;1234&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>###Content-Security-Policy</p> <blockquote><p>内容安全策略</p></blockquote> <ul><li>限制资源获取</li> <li>报告资源获取越权</li> <li>default-src 限制全局</li> <li>指定资源类型</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">//仅允许http和https</span>
  <span class="token string">&quot;Content-Security-Policy&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;default-src http:https:&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">//仅允许本站脚本</span>
  <span class="token string">&quot;Content-Security-Policy&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;default-src 'self'&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">//限制特定类型</span>
  <span class="token string">&quot;Content-Security-Policy&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;script-src http:https:&quot;</span>
  <span class="token comment">//汇报</span>
  <span class="token string">&quot;Content-Security-Policy&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;script-src ; report-uri /report&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.0d710046.js" defer></script><script src="/blog/assets/js/2.3724615d.js" defer></script><script src="/blog/assets/js/24.92a8097d.js" defer></script>
  </body>
</html>
