<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>常见命令 | 哒哒的博客</title>
    <meta name="description" content="哒哒练习写文章做记录的地方">
    <link rel="icon" href="/blog/img/logo.png">
    
    <link rel="preload" href="/blog/assets/css/0.styles.1846c831.css" as="style"><link rel="preload" href="/blog/assets/js/app.b3511b6e.js" as="script"><link rel="preload" href="/blog/assets/js/2.3279b9ab.js" as="script"><link rel="preload" href="/blog/assets/js/30.4610004f.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.85eddab2.js"><link rel="prefetch" href="/blog/assets/js/11.5bb2bda7.js"><link rel="prefetch" href="/blog/assets/js/12.18116cf1.js"><link rel="prefetch" href="/blog/assets/js/13.b6c0a829.js"><link rel="prefetch" href="/blog/assets/js/14.ef4fd82e.js"><link rel="prefetch" href="/blog/assets/js/15.9995b3bb.js"><link rel="prefetch" href="/blog/assets/js/16.4fcadb29.js"><link rel="prefetch" href="/blog/assets/js/17.f3296f2e.js"><link rel="prefetch" href="/blog/assets/js/18.74e4cc62.js"><link rel="prefetch" href="/blog/assets/js/19.a8bf8e39.js"><link rel="prefetch" href="/blog/assets/js/20.ee01241b.js"><link rel="prefetch" href="/blog/assets/js/21.5888843c.js"><link rel="prefetch" href="/blog/assets/js/22.f77267cb.js"><link rel="prefetch" href="/blog/assets/js/23.d1bbf196.js"><link rel="prefetch" href="/blog/assets/js/24.71cfc03b.js"><link rel="prefetch" href="/blog/assets/js/25.f4614047.js"><link rel="prefetch" href="/blog/assets/js/26.151b3bea.js"><link rel="prefetch" href="/blog/assets/js/27.d65421c0.js"><link rel="prefetch" href="/blog/assets/js/28.3b3e952f.js"><link rel="prefetch" href="/blog/assets/js/29.aac8f424.js"><link rel="prefetch" href="/blog/assets/js/3.7bc750c7.js"><link rel="prefetch" href="/blog/assets/js/31.5f217b1a.js"><link rel="prefetch" href="/blog/assets/js/32.d8c4d194.js"><link rel="prefetch" href="/blog/assets/js/33.125e272e.js"><link rel="prefetch" href="/blog/assets/js/34.15eaa4ae.js"><link rel="prefetch" href="/blog/assets/js/35.6d54a2a1.js"><link rel="prefetch" href="/blog/assets/js/4.0819c41d.js"><link rel="prefetch" href="/blog/assets/js/5.61f55bd5.js"><link rel="prefetch" href="/blog/assets/js/6.d738666b.js"><link rel="prefetch" href="/blog/assets/js/7.3466bc73.js"><link rel="prefetch" href="/blog/assets/js/8.6bfb5ec5.js"><link rel="prefetch" href="/blog/assets/js/9.e285ac9e.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.1846c831.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">哒哒的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JS基础</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/JS/object.html" class="nav-link">JS之面向对象程序设计和继承</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/write.html" class="nav-link">手写代码系列</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/base.html" class="nav-link">JS基础知识总结</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/copy.html" class="nav-link">JS深浅拷贝</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/design.html" class="nav-link">JS设计模式</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/this.html" class="nav-link">JS之this指向</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/ifelse.html" class="nav-link">JS条件语句</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/simple.html" class="nav-link">JS之代码简洁之道</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">框架+App</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/app/vue.html" class="nav-link">vue基础知识</a></li><li class="dropdown-item"><!----> <a href="/blog/app/vuex.html" class="nav-link">vuex基础</a></li><li class="dropdown-item"><!----> <a href="/blog/app/cordova.html" class="nav-link">cordova基础</a></li><li class="dropdown-item"><!----> <a href="/blog/app/vueCordova.html" class="nav-link">vue+cordova思考</a></li><li class="dropdown-item"><!----> <a href="/blog/app/RNSummary.html" class="nav-link">ReactNative技术栈总结</a></li><li class="dropdown-item"><!----> <a href="/blog/app/RNRecord.html" class="nav-link">ReactNative知识点记录</a></li><li class="dropdown-item"><!----> <a href="/blog/app/flutter_1.html" class="nav-link">flutter学习笔记</a></li><li class="dropdown-item"><!----> <a href="/blog/app/uniapp.html" class="nav-link">小程序多端框架研究</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Node/koa2.html" class="nav-link">koa2+sequelize初探</a></li><li class="dropdown-item"><!----> <a href="/blog/Node/fullStack.html" class="nav-link">全栈工程思考</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">浏览器</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/web/http.html" class="nav-link">http协议总结</a></li><li class="dropdown-item"><!----> <a href="/blog/web/web_1.html" class="nav-link">浏览器的执行顺序和结构</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">构建</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/goujian/webpack.html" class="nav-link">webpack学习</a></li><li class="dropdown-item"><!----> <a href="/blog/goujian/cli.html" class="nav-link">从零搭建一个脚手架</a></li><li class="dropdown-item"><!----> <a href="/blog/goujian/docker.html" class="nav-link router-link-exact-active router-link-active">docker学习笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/base/computer.html" class="nav-link">计算机基础</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JS基础</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/JS/object.html" class="nav-link">JS之面向对象程序设计和继承</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/write.html" class="nav-link">手写代码系列</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/base.html" class="nav-link">JS基础知识总结</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/copy.html" class="nav-link">JS深浅拷贝</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/design.html" class="nav-link">JS设计模式</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/this.html" class="nav-link">JS之this指向</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/ifelse.html" class="nav-link">JS条件语句</a></li><li class="dropdown-item"><!----> <a href="/blog/JS/simple.html" class="nav-link">JS之代码简洁之道</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">框架+App</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/app/vue.html" class="nav-link">vue基础知识</a></li><li class="dropdown-item"><!----> <a href="/blog/app/vuex.html" class="nav-link">vuex基础</a></li><li class="dropdown-item"><!----> <a href="/blog/app/cordova.html" class="nav-link">cordova基础</a></li><li class="dropdown-item"><!----> <a href="/blog/app/vueCordova.html" class="nav-link">vue+cordova思考</a></li><li class="dropdown-item"><!----> <a href="/blog/app/RNSummary.html" class="nav-link">ReactNative技术栈总结</a></li><li class="dropdown-item"><!----> <a href="/blog/app/RNRecord.html" class="nav-link">ReactNative知识点记录</a></li><li class="dropdown-item"><!----> <a href="/blog/app/flutter_1.html" class="nav-link">flutter学习笔记</a></li><li class="dropdown-item"><!----> <a href="/blog/app/uniapp.html" class="nav-link">小程序多端框架研究</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Node/koa2.html" class="nav-link">koa2+sequelize初探</a></li><li class="dropdown-item"><!----> <a href="/blog/Node/fullStack.html" class="nav-link">全栈工程思考</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">浏览器</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/web/http.html" class="nav-link">http协议总结</a></li><li class="dropdown-item"><!----> <a href="/blog/web/web_1.html" class="nav-link">浏览器的执行顺序和结构</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">构建</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/goujian/webpack.html" class="nav-link">webpack学习</a></li><li class="dropdown-item"><!----> <a href="/blog/goujian/cli.html" class="nav-link">从零搭建一个脚手架</a></li><li class="dropdown-item"><!----> <a href="/blog/goujian/docker.html" class="nav-link router-link-exact-active router-link-active">docker学习笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/base/computer.html" class="nav-link">计算机基础</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>常见命令</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/goujian/docker.html#常见命令" class="sidebar-link">常见命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/goujian/docker.html#下载-docker" class="sidebar-link">下载 docker</a></li></ul></li><li><a href="/blog/goujian/docker.html#docke-基础" class="sidebar-link">docke 基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/goujian/docker.html#_1-docker-提供了一个开发，打包，运行-app-的平台" class="sidebar-link">1. docker 提供了一个开发，打包，运行 app 的平台</a></li><li class="sidebar-sub-header"><a href="/blog/goujian/docker.html#_2-image-镜像" class="sidebar-link">2. image:镜像</a></li><li class="sidebar-sub-header"><a href="/blog/goujian/docker.html#_3-container：容器" class="sidebar-link">3. container：容器</a></li><li class="sidebar-sub-header"><a href="/blog/goujian/docker.html#_4-构建自己的-docker-镜像" class="sidebar-link">4. 构建自己的 docker 镜像</a></li><li class="sidebar-sub-header"><a href="/blog/goujian/docker.html#_5-dockerfile-语法解析" class="sidebar-link">5. dockerfile 语法解析</a></li><li class="sidebar-sub-header"><a href="/blog/goujian/docker.html#_6-将-image-发布到-dockerhub" class="sidebar-link">6. 将 image 发布到 dockerhub</a></li></ul></li><li><a href="/blog/goujian/docker.html#docker-network" class="sidebar-link">docker network</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/goujian/docker.html#端口映射" class="sidebar-link">端口映射</a></li></ul></li><li><a href="/blog/goujian/docker.html#docker-volumn-数据持久化" class="sidebar-link">docker volumn 数据持久化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/goujian/docker.html#volumn-的类型" class="sidebar-link">volumn 的类型</a></li><li class="sidebar-sub-header"><a href="/blog/goujian/docker.html#具体用法" class="sidebar-link">具体用法</a></li><li class="sidebar-sub-header"><a href="/blog/goujian/docker.html#bind-mounting" class="sidebar-link">bind mounting</a></li></ul></li><li><a href="/blog/goujian/docker.html#docker-compose" class="sidebar-link">docker-compose</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/goujian/docker.html#基础命令" class="sidebar-link">基础命令</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/goujian/docker.html#配置-docker-compose-yml" class="sidebar-link">配置 docker-compose.yml</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="常见命令"><a href="#常见命令" aria-hidden="true" class="header-anchor">#</a> 常见命令</h2> <h3 id="下载-docker"><a href="#下载-docker" aria-hidden="true" class="header-anchor">#</a> 下载 docker</h3> <h4 id="centos"><a href="#centos" aria-hidden="true" class="header-anchor">#</a> centOS</h4> <ol><li>移除服务器上老的 docker</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>sudo yum remove docker \
                  docker<span class="token operator">-</span>client \
                  docker<span class="token operator">-</span>client<span class="token operator">-</span>latest \
                  docker<span class="token operator">-</span>common \
                  docker<span class="token operator">-</span>latest \
                  docker<span class="token operator">-</span>latest<span class="token operator">-</span>logrotate \
                  docker<span class="token operator">-</span>logrotate \
                  docker<span class="token operator">-</span>engine
</code></pre></div><ol start="2"><li>下载对应插件</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>sudo yum install <span class="token operator">-</span>y yum<span class="token operator">-</span>utils \
  device<span class="token operator">-</span>mapper<span class="token operator">-</span>persistent<span class="token operator">-</span>data \
  lvm2
</code></pre></div><ol start="3"><li>配置仓库</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>sudo yum<span class="token operator">-</span>config<span class="token operator">-</span>manager \
    <span class="token operator">--</span>add<span class="token operator">-</span>repo \
    https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>download<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>com<span class="token operator">/</span>linux<span class="token operator">/</span>centos<span class="token operator">/</span>docker<span class="token operator">-</span>ce<span class="token punctuation">.</span>repo
</code></pre></div><ol start="4"><li>下载 docker-cli</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>sudo yum install docker<span class="token operator">-</span>ce docker<span class="token operator">-</span>ce<span class="token operator">-</span>cli containerd<span class="token punctuation">.</span>io
</code></pre></div><ol start="5"><li><p>启动 docker——<code>sudo systemctl start docker</code></p></li> <li><p>测试 docker 安装是否成功——<code>sudo docker run hello-world</code></p></li> <li><p>查看当前下载镜像<code>docker image ls</code></p></li> <li><p>下载 docker-compose</p></li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>sudo curl <span class="token operator">-</span><span class="token constant">L</span> <span class="token string">&quot;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)&quot;</span> <span class="token operator">-</span>o <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>docker<span class="token operator">-</span>compose
</code></pre></div><ol start="9"><li><p>解析 docker-compose
<code>sudo chmod +x /usr/local/bin/docker-compose</code></p></li> <li><p>配置 docker-compose 的路径
<code>sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</code></p></li> <li><p>查看版本<code>docker-compose --version</code></p></li></ol> <h2 id="docke-基础"><a href="#docke-基础" aria-hidden="true" class="header-anchor">#</a> docke 基础</h2> <h3 id="_1-docker-提供了一个开发，打包，运行-app-的平台"><a href="#_1-docker-提供了一个开发，打包，运行-app-的平台" aria-hidden="true" class="header-anchor">#</a> 1. docker 提供了一个开发，打包，运行 app 的平台</h3> <h3 id="_2-image-镜像"><a href="#_2-image-镜像" aria-hidden="true" class="header-anchor">#</a> 2. image:镜像</h3> <ul><li>文件和 meta data 的集合（root filesystem）</li> <li>分层的，并且每一层都可以添加改变删除文件，成为一个新的 image</li> <li>不同的 image 可以共享相同的 layer</li> <li>image 本身是 read-only 的</li></ul> <h4 id="获取-image-build-from-dockerfile"><a href="#获取-image-build-from-dockerfile" aria-hidden="true" class="header-anchor">#</a> 获取 image: build from dockerfile</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//  选择基本image</span>
<span class="token constant">FROM</span> ubuntu<span class="token punctuation">:</span><span class="token number">14.04</span>
<span class="token comment">//  选择基本标识</span>
<span class="token constant">LABEL</span> maintainer<span class="token operator">=</span><span class="token string">&quot;Peng Xiao &lt;xiaoquwl@gmail.com&gt;&quot;</span>
<span class="token comment">// 运行代码</span>
<span class="token constant">RUN</span> apt<span class="token operator">-</span><span class="token keyword">get</span> update <span class="token operator">&amp;&amp;</span> apt<span class="token operator">-</span><span class="token keyword">get</span> install <span class="token operator">-</span>y redis<span class="token operator">-</span>server

<span class="token comment">// 暴露的端口</span>
<span class="token constant">EXPOSE</span> <span class="token number">6379</span>
<span class="token comment">// 程序的入口，启动redis-server</span>
<span class="token constant">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">&quot;/usr/bin/redis-server&quot;</span><span class="token punctuation">]</span>

</code></pre></div><p>然后执行命令<code>docker build -t xiaopeng163/redis:latest .</code> <code>-t</code>表示当前目录的名字
<code>.</code> 表示基于当前目录的 dockerfile 构建</p> <h4 id="获取-image-pull-from-registry"><a href="#获取-image-pull-from-registry" aria-hidden="true" class="header-anchor">#</a> 获取 image:pull from registry</h4> <blockquote><p>类似与 git，把 image 传到 registry 上面(dockerhub)，然后通过 pull 命令拉取</p></blockquote> <p>eg: <code>docker pull ubuntu:14.04</code></p> <h4 id="构建一个-base-image"><a href="#构建一个-base-image" aria-hidden="true" class="header-anchor">#</a> 构建一个 base image</h4> <ol><li><p>创建一个 dockerfile 文件</p></li> <li><p>编写 dockerfile</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token constant">FROM</span> scratch

<span class="token constant">ADD</span> hello <span class="token operator">/</span>

<span class="token constant">CMD</span> <span class="token punctuation">[</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">]</span>
</code></pre></div></li> <li><p><code>docker build -t xiaopeng163/hello-world .</code> 在 dockerhub 上的 xiaopeng163 中创建名为 hello-world 的 image</p></li></ol> <h3 id="_3-container：容器"><a href="#_3-container：容器" aria-hidden="true" class="header-anchor">#</a> 3. container：容器</h3> <ul><li>通过 Image 创建（copy）</li> <li>在 Image layer 之上建立一个 container layer (可读写)</li> <li>类比面向对象：类和实例</li> <li>Image 负责 app 的存储和分发，container 负责运行 app</li></ul> <h3 id="_4-构建自己的-docker-镜像"><a href="#_4-构建自己的-docker-镜像" aria-hidden="true" class="header-anchor">#</a> 4. 构建自己的 docker 镜像</h3> <blockquote><p>对 base image 的某一个 container 做了修改之后，重新构建为新的 image</p></blockquote> <ul><li><p>docker container commit</p> <p><code>docker commit containerName dockerhubRep/imgName</code></p> <p>不太提倡，无法保障 image 的安全</p></li> <li><p>docker image build</p> <blockquote><p>通过 dockerfile build 一个 image</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token constant">FROM</span> centos

<span class="token constant">RUN</span> yum install <span class="token operator">-</span>y vim
<span class="token comment">// 我们知道image是不可变的，在build过程中，会生成一个临时的container，这个和js的包装对象类似</span>
</code></pre></div><p>运行<code>docker build -t dockerhubRep/imageName .</code></p></li></ul> <h3 id="_5-dockerfile-语法解析"><a href="#_5-dockerfile-语法解析" aria-hidden="true" class="header-anchor">#</a> 5. dockerfile 语法解析</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
  <span class="token comment">// 尽量使用官方的image，确保安全</span>
  <span class="token comment">// 制作base image</span>
  <span class="token constant">FROM</span> scratch
  <span class="token comment">// 使用base image;</span>
  <span class="token constant">FROM</span> centos

  <span class="token comment">// image的信息，类似与代码中的注释</span>
  <span class="token constant">LABEL</span> maintainer
  <span class="token constant">LABEL</span> version
  <span class="token constant">LABEL</span> description

  <span class="token comment">// 每运行一个RUN，都会新生成一个layer,故建议通过&amp;&amp;和\将多个命令合并为一个</span>
  <span class="token constant">RUN</span>

  <span class="token comment">// 设定当前工作目录，如果根目录下没有root，会自动创建，</span>
  <span class="token comment">// 使用workdir,不要用run cd ；尽量使用绝对目录</span>
  <span class="token constant">WORKDIR</span> <span class="token operator">/</span>root

  <span class="token comment">// 将文件添加到指定目录</span>
  <span class="token comment">// ADD 还可以解压缩</span>
  <span class="token comment">// 大部分情况，copy优于ADD，添加远程文件/目录使用curl或者wget</span>
  <span class="token constant">ADD</span> hello <span class="token operator">/</span>   将hello添加到根目录
  <span class="token constant">COPY</span>

  <span class="token comment">// 设置常量，尽量使用，增加可维护性</span>
  <span class="token constant">ENV</span>

  <span class="token comment">// 存储和网络</span>
  <span class="token constant">VOLUME</span> and <span class="token constant">EXPOSE</span>
</code></pre></div><p><code>RUN</code> 执行命令并创建新的 image layer</p> <p><code>CMD</code> 设置容器启动后默认执行的命令和参数
如果 docker run 指定了其他命令，cmd 命令被忽略
如果定义了多个 cmd ，只有最后一个会执行</p> <p><code>ENTRYPOINT</code> 设置容器启动时运行的命令
不会被忽略，一定会执行
最佳实践：写一个 shell 脚本作为 entrypoint</p> <pre><code>        ```javascript
        COPY docker-entrypoint.sh /usr/local/bin/
        ENTRYPOINT ['docker-entrypoint.sh']
        EXPOSE 27017
        CMD [&quot;mongod&quot;]
        ```
</code></pre> <p>shell 格式</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token constant">RUN</span> apt<span class="token operator">-</span><span class="token keyword">get</span> install <span class="token operator">-</span>y vim
<span class="token constant">CMD</span> echo <span class="token string">&quot;hello docker&quot;</span>
<span class="token constant">ENTRYPOINT</span> echo <span class="token string">&quot;hello docker&quot;</span>
</code></pre></div><p>Exec 格式</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token constant">RUN</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">&quot;apt-get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;install&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-y&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;vim&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token constant">CMD</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">&quot;echo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello docker&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token constant">ENTRYPOINT</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">&quot;echo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello docker&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-将-image-发布到-dockerhub"><a href="#_6-将-image-发布到-dockerhub" aria-hidden="true" class="header-anchor">#</a> 6. 将 image 发布到 dockerhub</h3> <ul><li>docker login</li> <li>docker push imageName:tag</li></ul> <h2 id="docker-network"><a href="#docker-network" aria-hidden="true" class="header-anchor">#</a> docker network</h2> <h3 id="端口映射"><a href="#端口映射" aria-hidden="true" class="header-anchor">#</a> 端口映射</h3> <p><code>docker run --name web -d -p 80:80 nginx</code></p> <p>--name: 容器命名
-d:后台运行
-p:端口映射 主机端口：容器端口</p> <h2 id="docker-volumn-数据持久化"><a href="#docker-volumn-数据持久化" aria-hidden="true" class="header-anchor">#</a> docker volumn 数据持久化</h2> <ul><li>基于本地文件系统的 volumn
可以在执行 docker create 或 docker run 时，通过-v 参数将主机的目录作为容器的数据卷。</li> <li>基于 plugin 的 volumn，支持第三方的存储方案，比如 nas,aws</li></ul> <h3 id="volumn-的类型"><a href="#volumn-的类型" aria-hidden="true" class="header-anchor">#</a> volumn 的类型</h3> <ul><li>受管理的 data volumn，由 docker 后台自动创建。</li> <li>绑定挂载的 volumn，具体挂载位置可以由用户指定。</li></ul> <h3 id="具体用法"><a href="#具体用法" aria-hidden="true" class="header-anchor">#</a> 具体用法</h3> <blockquote><p>dockerfile 中：volume ['/var/lib/mysql']</p></blockquote> <ol><li><code>docker volumn ls</code> 查看 volume</li> <li><code>docker volumn inspect id</code> 查看指定 volume</li> <li><code>docker volumn rm id</code> 删除 volume</li> <li><code>docker run -d -v mysql:/var/lib/mysql --name mysql1</code> -v 将/var/lib/mysql 的 volume 命名为 mysql</li></ol> <h3 id="bind-mounting"><a href="#bind-mounting" aria-hidden="true" class="header-anchor">#</a> bind mounting</h3> <blockquote><p>将本地文件和容器映射</p></blockquote> <p><code>docker run -d -v $(pwd):/usr/share/nginx/html -p 80:80 --name web 。。。</code></p> <p>$(pwd)代表当前目录</p> <h2 id="docker-compose"><a href="#docker-compose" aria-hidden="true" class="header-anchor">#</a> docker-compose</h2> <blockquote><p>批处理多容器的 app</p></blockquote> <ul><li>是一个基于 docker 的命令行工具</li> <li>通过一个 yml 文件定义多容器的 docker 应用</li> <li>通过一条命令就可以根据 yml 文件的定义去创建或者管理多个容器</li> <li>yml 主要包括 services,networks,volumes</li></ul> <h2 id="基础命令"><a href="#基础命令" aria-hidden="true" class="header-anchor">#</a> 基础命令</h2> <ol><li><p><code>docker image ls</code> 查看本机的 image</p> <p><code>docker image rm id</code> 删除某一个 image</p></li> <li><p><code>docker container ls</code> 查看本机的正在运行的容器</p> <p><code>docker container ls -a</code>查看历史运行过的容器</p> <p><code>docker container rm id</code> 删除某一个容器</p></li> <li><p><code>docker run/exec -it name /bin/bash</code> 运行某一个容器并进入 bash</p></li> <li><p><code>docker network inspect bridge</code> 看到对应容器的 bridge
<code>ping ip</code> ping 通 ip
<code>telnet ip:duankou</code> 查看端口情况
<code>curl ip</code> 访问 ip</p></li> <li><p><code>docker-compose up -d</code> 根据命令行目录下的 docker-compose.yml 文件起项目，-d 不打印日志并后台运行</p></li> <li><p><code>docker-compose ps</code> 查看多个容器中的服务的情况</p></li> <li><p><code>docker-compose stop</code> 关闭容器中的服务但不删除</p></li> <li><p><code>docker-compose done</code> 关闭容器并删除容器</p></li> <li><p><code>docker-compose images</code> 列出 images</p></li> <li><p><code>docker-compose exec [container] bash</code> 进入容器的 bash 命令行</p></li> <li><p>``</p></li></ol> <h2 id="配置-docker-compose-yml"><a href="#配置-docker-compose-yml" aria-hidden="true" class="header-anchor">#</a> 配置 docker-compose.yml</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code></code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">11/5/2019, 10:39:38 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.b3511b6e.js" defer></script><script src="/blog/assets/js/2.3279b9ab.js" defer></script><script src="/blog/assets/js/30.4610004f.js" defer></script>
  </body>
</html>
