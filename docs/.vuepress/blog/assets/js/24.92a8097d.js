(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{274:function(t,s,a){"use strict";a.r(s);var n=a(38),p=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("#HTTP 协议总结")]),t._v(" "),a("p",[t._v("##Http 协议基础")]),t._v(" "),a("p",[t._v("###经典五层模型")]),t._v(" "),a("blockquote",[a("p",[t._v("应用层——传输层——网络层——数据链路层——物理层")])]),t._v(" "),a("ol",[a("li",[t._v("物理层主要作用是定义物理设备如何传输数据，指代物理硬件")]),t._v(" "),a("li",[t._v("数据链路层在通信的实体间建立数据链路连接，基本计算机二进制传输")]),t._v(" "),a("li",[t._v("网络层为数据在节点之间传输创建逻辑链路")]),t._v(" "),a("li",[t._v("传输层为 TCP 或 UDP，可以想象为一条管道")]),t._v(" "),a("li",[t._v("应用层为 HTTP，可以想象为一个包")])]),t._v(" "),a("p",[t._v("基本概念：一个 tcp 可以发送多个 http 请求，一个 http 请求必须在一个 tcp 连接里")]),t._v(" "),a("p",[t._v("###http 发展历史\n####http/0.9")]),t._v(" "),a("ul",[a("li",[t._v("只有一个命令 GET")]),t._v(" "),a("li",[t._v("没有 HEADER 等描述数据的信息")]),t._v(" "),a("li",[t._v("服务器发送完毕，就关闭 TCP 连接")])]),t._v(" "),a("p",[t._v("####http/1.0")]),t._v(" "),a("ul",[a("li",[t._v("增加了很多命令，POST,PUT")]),t._v(" "),a("li",[t._v("增加了 status code 和 header")]),t._v(" "),a("li",[t._v("多字符集支持、多部分发送、权限、缓存等")])]),t._v(" "),a("p",[t._v("####http/1.1")]),t._v(" "),a("ul",[a("li",[t._v("支持了持久连接")]),t._v(" "),a("li",[t._v("pipeline,管道化")]),t._v(" "),a("li",[t._v("增加 host 和其他一些命令")])]),t._v(" "),a("p",[t._v("####http2")]),t._v(" "),a("ul",[a("li",[t._v("所有数据以二进制传输，摆脱原来的字符串")]),t._v(" "),a("li",[t._v("同一个连接里面发送多个请求不再需要按照顺序来，并行")]),t._v(" "),a("li",[t._v("头信息压缩以及推送等提高效率的功能，服务端可以主动发送信息，提升性能")])]),t._v(" "),a("p",[t._v("###三次握手")]),t._v(" "),a("blockquote",[a("p",[t._v("http 不存在连接，只有请求和响应\nTCP 连接可以发送多个 http 请求，TCP 连接有三次握手网络请求的消耗")])]),t._v(" "),a("ol",[a("li",[t._v("客户端发送连接数据包")]),t._v(" "),a("li",[t._v("服务端开启 TCP SOCKET,再给客户端发送数据包")]),t._v(" "),a("li",[t._v("客户端拿到数据包，再给服务端发送确认数据包")])]),t._v(" "),a("p",[t._v("第三次是为了避免第二次握手丢失，导致服务端一直开启端口连接")]),t._v(" "),a("p",[t._v("###URI——URL 和 URN\n####URI")]),t._v(" "),a("blockquote",[a("p",[t._v("统一资源标志符/Uniform Resource Identifier")])]),t._v(" "),a("ul",[a("li",[t._v("用来唯一标识互联网上的信息资源")]),t._v(" "),a("li",[t._v("包括 URL 和 URN")])]),t._v(" "),a("p",[t._v("####URL")]),t._v(" "),a("blockquote",[a("p",[t._v("统一资源定位器/Uniform Resource Locator")])]),t._v(" "),a("ul",[a("li",[t._v("http://user:pass@host.com:80/path?query=string#hash")]),t._v(" "),a("li",[t._v("http 协议")]),t._v(" "),a("li",[t._v("user:pass 用户认证，基本用不到")]),t._v(" "),a("li",[t._v("host.com 定位服务在互联网上的位子，可以为 IP 或者域名")]),t._v(" "),a("li",[t._v("80 端口，web 服务，物理服务器上多个 web 服务，不带端口默认访问 80")]),t._v(" "),a("li",[t._v("path 路由，web 服务上具体的内容")]),t._v(" "),a("li",[t._v("query 搜索参数，如何进行搜索和查找，传参")]),t._v(" "),a("li",[t._v("hash 锚点定位工具")])]),t._v(" "),a("p",[t._v("此类格式的都叫做 URL，比如 http,ftp 协议")]),t._v(" "),a("p",[t._v("####URN")]),t._v(" "),a("blockquote",[a("p",[t._v("永久统一资源定位符")])]),t._v(" "),a("ul",[a("li",[t._v("在资源移动之后还能被找到")]),t._v(" "),a("li",[t._v("目前还没有非常成熟的使用方案")])]),t._v(" "),a("p",[t._v("###http 报文格式")]),t._v(" "),a("p",[t._v("####起始行")]),t._v(" "),a("ul",[a("li",[t._v("请求报文：GET /text/test.txt HTTP/1.0")]),t._v(" "),a("li",[t._v("响应报文：HTTP/1.0 200 OK")])]),t._v(" "),a("p",[t._v("####头部")]),t._v(" "),a("ul",[a("li",[t._v("请求头：Accept:text/* Accept-Language:en,fr")]),t._v(" "),a("li",[t._v("响应头：Content-type:text/plain Content-length:19")])]),t._v(" "),a("p",[t._v("####主体")]),t._v(" "),a("ul",[a("li",[t._v("请求体：参数")]),t._v(" "),a("li",[t._v("响应体：返回的数据")])]),t._v(" "),a("p",[t._v("####HTTP 的方法")]),t._v(" "),a("ul",[a("li",[t._v("用来定义对于资源的操作")]),t._v(" "),a("li",[t._v("常用有 GET,POST 等")]),t._v(" "),a("li",[t._v("从定义上讲有各自的语义")])]),t._v(" "),a("p",[t._v("####HTTP CODE")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("定义服务器对请求的处理结果")])]),t._v(" "),a("li",[a("p",[t._v("各个区间的 CODE 有各自的语义")]),t._v(" "),a("ul",[a("li",[t._v("100-199 还需要一些操作才能发送请求")]),t._v(" "),a("li",[t._v("200-299 操作成功")]),t._v(" "),a("li",[t._v("300-399 重定向")]),t._v(" "),a("li",[t._v("400-499 发送的请求有问题 401 认证 403 被拒绝 404 找不到")]),t._v(" "),a("li",[t._v("500-599 服务端问题")])])]),t._v(" "),a("li",[a("p",[t._v("好的 HTTP 服务可以通过 CODE 判断结果")])])]),t._v(" "),a("p",[t._v("###创建一个简单的 web 服务")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" http "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nhttp\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"req come"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"123"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9999")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("##HTTP 各种特性")]),t._v(" "),a("p",[t._v("###CORS 跨域请求的限制与解决")]),t._v(" "),a("blockquote",[a("p",[t._v("浏览器对于非同域的请求会拦截，请求还是会发送，后台服务返回内容，但是浏览器会拦截掉并报错")])]),t._v(" "),a("p",[t._v("####简单请求")]),t._v(" "),a("ul",[a("li",[t._v("允许方法仅为 GET，HEAD，POST")]),t._v(" "),a("li",[t._v("Content-Type 仅为 text/plain,multipart/form-data,application/x-www-form-urlencoded")]),t._v(" "),a("li",[t._v("请求头限制，仅部分固定请求头允许")]),t._v(" "),a("li",[t._v("XMLHttpRequestUpload 对象均没有注册任何事件监听器")]),t._v(" "),a("li",[t._v("请求中没有使用 ReadableStream 对象")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Origin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("####预请求")]),t._v(" "),a("blockquote",[a("p",[t._v("先通过 OPTION 请求访问服务端，返回告诉浏览器允许接下来发送的 POST 请求，浏览器就不会拦截")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Origin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Headers"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//允许的请求头")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Methods"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//允许的请求方法")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Max-Age"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//预请求不需option验证的最大时间")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("####jsonp")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script src"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://127.0.0.1:8888"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("p",[t._v("###Cache-Control")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("public 任何地方都可以进行缓存")])]),t._v(" "),a("li",[a("p",[t._v("private 只有发起请求的浏览器进行缓存")])]),t._v(" "),a("li",[a("p",[t._v("no-cache 本地可以存缓存，但需要后台验证过后才能使用")])]),t._v(" "),a("li",[a("p",[t._v("max-age 秒数，缓存存在的最大时间")])]),t._v(" "),a("li",[a("p",[t._v("s-maxage 秒数，在代理服务器，会代替 max-age")])]),t._v(" "),a("li",[a("p",[t._v("max-stale 秒数，发起请求主动带的头的到期时间")])]),t._v(" "),a("li",[a("p",[t._v("must-revalidate 重新验证")])]),t._v(" "),a("li",[a("p",[t._v("proxy-revalidate 用在缓存服务器上，必须重新验证")])]),t._v(" "),a("li",[a("p",[t._v("no-store 不存储缓存")])]),t._v(" "),a("li",[a("p",[t._v("no-transform 用在代理服务器，不改动返回内容")])])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("http\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text/javascript"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Cache-Control"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"max-age=20"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//会取缓存的内容，请求不会发送到服务器")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"123"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9999")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("一般缓存会是一个比较长的时间，这就导致服务端更新内容，客户端却还是取老的静态资源。现在常用的方法是每次打包时在静态路径上添加一个 hash 码，hash 码根据文件改变而来，这样浏览器访问静态资源时就会从新请求。")])]),t._v(" "),a("p",[t._v("###缓存验证 Last-Modified 和 Etag 的使用")]),t._v(" "),a("p",[t._v("有 Cache-Control 的情况下\n"),a("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/9421914-35ed48b943da3263.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"http.png"}})]),t._v(" "),a("p",[t._v("####验证头\n"),a("strong",[t._v("Last-Modified")]),t._v("\n上次修改时间，给资源设置上一次何时修改\n配合 if-Modified-Since 或者 if-Unmodified-Since 使用\n对比上次修改时间判断是否需要更新")]),t._v(" "),a("p",[a("strong",[t._v("Etag")]),t._v("\n数据签名，数据唯一标识，数据修改，那么签名会不一样\n配合 if-Match 或者 If-Non-Match 使用\n对比资源的签名判断是否使用缓存")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//服务端进行etag的验证")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" etag"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'if-none-match'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("etag"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'777'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("304")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Cache-Control'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'max-age=200000,no-cache'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Last-Modified'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'123'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Etag'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'777'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Cache-Control'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'max-age=200000,no-cache'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Last-Modified'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'123'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Etag'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'777'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'123'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("###Cookie 和 Session")]),t._v(" "),a("p",[t._v("####Cookie")]),t._v(" "),a("blockquote",[a("p",[t._v("在服务端返回数据时，通过 Set-Cookie 保存在浏览器，浏览器下次在同域的请求中会在头带上 Cookie，")])]),t._v(" "),a("ul",[a("li",[t._v("通过 Set-Cookie 设置")]),t._v(" "),a("li",[t._v("下次请求会自动带上")]),t._v(" "),a("li",[t._v("键值对，可以设置多个")]),t._v(" "),a("li",[t._v("max-age 和 expires 设置过期时间")]),t._v(" "),a("li",[t._v("Secure 只在 https 的时候发送")]),t._v(" "),a("li",[t._v("HttpOnly 无法通过 document.cookie 访问")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" host "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("host\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" html"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("fs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFileSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test.html'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("host "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Set-Cookie"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id=123;max-age=2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"abc=456;HttpOnly;domain=test.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//此时test.com下的所有二级域名都可以访问到cookie")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'html'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("####Session")]),t._v(" "),a("blockquote",[a("p",[t._v("经常做法是将保存在 session 中的用户唯一 ID 存入 Cookie,下次请求时拿到 Cookie，通过 Cookie 在 Session 拿到用户信息，进行操作。")])]),t._v(" "),a("p",[t._v("###Http 长连接")]),t._v(" "),a("blockquote",[a("p",[t._v("http1.1 默认是长连接， 是在 tcp 上顺序发送请求，浏览器 tcp 并发限制为 6，就是同时可以存在 6 个连接。所以浏览器加载首页时，先创建 6 个 TCP 连接，然后 http 是在这六个连接中顺序发送的。")])]),t._v(" "),a("p",[t._v("###数据协商")]),t._v(" "),a("blockquote",[a("p",[t._v("客户端在发送请求时，限定需要拿到的数据格式，内容等。服务端根据这些限制来操作，服务端不一定按照规定返回。\n"),a("strong",[t._v("请求")])])]),t._v(" "),a("ul",[a("li",[t._v("Accept 想要的数据类型")]),t._v(" "),a("li",[t._v("Accept-Encoding 数据编码方式进行传输，限制服务器对数据的压缩方式")]),t._v(" "),a("li",[t._v("Accept-Language 希望展示的语言")]),t._v(" "),a("li",[t._v("User-Agent 浏览器的相关信息\n"),a("strong",[t._v("返回")])]),t._v(" "),a("li",[t._v("Content-Type 实际返回的数据格式")]),t._v(" "),a("li",[t._v("Content-Encoding 对应 Accept-Encoding，声明传输方式")]),t._v(" "),a("li",[t._v("Content-Language 返回的语言")])]),t._v(" "),a("p",[t._v("###重定向")]),t._v(" "),a("blockquote",[a("p",[t._v("通过 URL 访问资源时，服务器告诉浏览器资源换位子了，并告诉新的位置，浏览器再请求新的位置,301 永久变更，302 暂时变更，301 的返回会在缓存中提取")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/old"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("302")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    Location"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/new"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/new"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1234"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("###Content-Security-Policy")]),t._v(" "),a("blockquote",[a("p",[t._v("内容安全策略")])]),t._v(" "),a("ul",[a("li",[t._v("限制资源获取")]),t._v(" "),a("li",[t._v("报告资源获取越权")]),t._v(" "),a("li",[t._v("default-src 限制全局")]),t._v(" "),a("li",[t._v("指定资源类型")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//仅允许http和https")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Security-Policy"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default-src http:https:"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//仅允许本站脚本")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Security-Policy"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"default-src 'self'\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//限制特定类型")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Security-Policy"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"script-src http:https:"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//汇报")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Security-Policy"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"script-src ; report-uri /report"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"123"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])},[],!1,null,null,null);s.default=p.exports}}]);